import{_ as q,f as u,r as n,o as V,A as k,n as l,b as r,l as y,k as s,q as I,U as K,m as T,a as E,E as H}from"./index-bf47055b.js";import{u as M,a as P,b as j}from"./orgs-f0b7c58e.js";import{u as z}from"./useRefFormData-84c825c7.js";import"./lodash-3ffe41b4.js";const G={class:"popover-pop-body"},J={__name:"add-or-update",emits:["refreshDataList"],setup(Q,{expose:C,emit:x}){const d=u(!1),m=u([]),_=u(),c=u(),f=u(),{dataForm:t,assign:L,reset:h}=z({id:"",name:"",pid:0,parent_name:"",sort:0}),O=o=>{d.value=!0,h(),o?w(o):i(),U()},U=()=>M().then(o=>{m.value=o.data}),w=o=>{P(o).then(e=>{if(L(e.data),t.value.pid===0)return i();_.value.setCurrentKey(t.value.pid)})},i=()=>{t.value.pid=0,t.value.parent_name="一级机构"},A=o=>{t.value.pid=o.id,t.value.parent_name=o.name,f.value.hide()},B=u({name:[{required:!0,message:"必填项不能为空",trigger:"blur"}],parent_name:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),v=()=>{c.value.validate(o=>{if(!o)return!1;j(t.value).then(()=>{H.success({message:"操作成功",duration:500,onClose:()=>{d.value=!1,x("refreshDataList")}})})})};return C({init:O}),(o,e)=>{const g=n("el-input"),p=n("el-form-item"),D=n("BaseSvgIcon"),F=n("el-tree"),N=n("el-popover"),R=n("el-input-number"),S=n("el-form"),b=n("el-button"),$=n("el-dialog");return V(),k($,{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value=a),title:s(t).id?"修改":"新增","close-on-click-modal":!1,draggable:""},{footer:l(()=>[r(b,{onClick:e[5]||(e[5]=a=>d.value=!1)},{default:l(()=>[y("取消")]),_:1}),r(b,{type:"primary",onClick:e[6]||(e[6]=a=>v())},{default:l(()=>[y("确定")]),_:1})]),default:l(()=>[r(S,{ref_key:"dataFormRef",ref:c,model:s(t),rules:B.value,"label-width":"120px",onKeyup:e[4]||(e[4]=I(a=>v(),["enter"]))},{default:l(()=>[r(p,{prop:"name",label:"名称"},{default:l(()=>[r(g,{modelValue:s(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>s(t).name=a),placeholder:"名称"},null,8,["modelValue"])]),_:1}),r(p,{prop:"parent_name",label:"上级机构",class:"org-list"},{default:l(()=>[r(N,{ref_key:"orgListPopover",ref:f,placement:"bottom-start",trigger:"click",width:400,"popper-class":"popover-pop"},{reference:l(()=>[r(g,{modelValue:s(t).parent_name,"onUpdate:modelValue":e[2]||(e[2]=a=>s(t).parent_name=a),readonly:!0,placeholder:"上级机构"},{suffix:l(()=>[s(t).pid!==0?(V(),k(D,{key:0,icon:"icon-close-circle",onClick:e[1]||(e[1]=K(a=>i(),["stop"]))})):T("",!0)]),_:1},8,["modelValue"])]),default:l(()=>[E("div",G,[r(F,{ref_key:"orgListTree",ref:_,data:m.value,props:{label:"name",children:"children"},"node-key":"id","highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:A},null,8,["data"])])]),_:1},512)]),_:1}),r(p,{prop:"sort",label:"排序"},{default:l(()=>[r(R,{modelValue:s(t).sort,"onUpdate:modelValue":e[3]||(e[3]=a=>s(t).sort=a),"controls-position":"right",min:0,label:"排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},ee=q(J,[["__scopeId","data-v-0e3b51e0"]]);export{ee as default};
