import{f as F,a5 as j,F as g,a6 as T,E as b,a1 as V,r as u,H as q,o as _,A as h,n as r,b as o,k as a,q as $,l as C,w as S,s as E}from"./index-bf47055b.js";import I from"./save-6c935ab7.js";import"./lodash-3ffe41b4.js";const K=w=>{const l=()=>{for(const t in e.value)Object.getOwnPropertyDescriptor(w,t)&&(e.value[t]=w[t])},e=F({baseUrl:"",deleteUrl:"",createdIsNeed:!0,isPage:!0,primaryKey:"id",queryForm:{},dataList:[],order:"",asc:!1,page:1,limit:10,total:0,pageSizes:[1,10,20,50,100,200],dataListLoading:!1,signalSelect:!1,dataListSelections:[]});l(),j(()=>{e.value.createdIsNeed&&s()});const s=async()=>{if(e.value.baseUrl){e.value.dataListLoading=!0;try{const t=await g.get(e.value.isPage?e.value.baseUrl+"/page":e.value.baseUrl+"/list",{params:{order:e.value.order,asc:e.value.asc,page:e.value.isPage?e.value.page:null,limit:e.value.isPage?e.value.limit:null,...e.value.queryForm}});e.value.dataList=e.value.isPage?t.data.list:t.data,e.value.total=e.value.isPage?t.data.total:0}catch{}finally{e.value.dataListLoading=!1}}};return{state:e,onDataList:async()=>{e.value.page=1,await s()},onInfo:t=>g.get(e.value.baseUrl+`/${t}`),onDelete:t=>{T.confirm("确定进行删除操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.delete(e.value.deleteUrl?e.value.deleteUrl:e.value.baseUrl+"/"+t).then(()=>{b.success("删除成功"),s()})}).catch(()=>{})},onSave:t=>t.id?g.put(e.value.baseUrl,t):g.post(e.value.baseUrl,t),onSizeChange:t=>{e.value.page=1,e.value.limit=t,s()},onCurrentChange:t=>{e.value.page=t,s()},onSelectionRow:(t,n,c)=>{t.isUse&&!c.isSelect||n.toggleRowSelection(t)},onSelectionChange:(t,n)=>{e.value.dataListSelections=t,e.value.signalSelect&&t.length>1&&(n.clearSelection(),n.toggleRowSelection(t.pop()))},onSortChange:t=>{const{prop:n,order:c}=t;n&&c?(e.value.order=n,e.value.asc=c==="ascending"):e.value.order="",s()},onDeleteBatch:t=>{let n=[];if(t)n=[t];else if(n=e.value.dataListSelections?e.value.dataListSelections:[],n.length===0){b.warning("请选择删除记录");return}T.confirm("确定进行删除操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.delete(e.value.deleteUrl?e.value.deleteUrl:e.value.baseUrl,{data:n}).then(()=>{b.success("删除成功"),s()})}).catch(()=>{})},onDownload:(t,n,c)=>V({responseType:"blob",url:t,method:c}).then(v=>{const i=document.createElement("a");i.download=n||new Date().getTime().toString(),i.style.display="none";let d=[];d.push(v.data),i.href=URL.createObjectURL(new Blob(d)),document.body.appendChild(i),i.click(),URL.revokeObjectURL(i.href),document.body.removeChild(i)}).catch(v=>{b.error(v.message)})}},N=E({name:"SysUser"}),G=Object.assign(N,{setup(w){const{state:l,onDataList:e,onSelectionChange:s,onSizeChange:D,onCurrentChange:x,onDelete:z}=K({baseUrl:"/sys/user",queryForm:{username:""}}),U=F(),L=k=>{U.value.show(k)};return(k,p)=>{const B=u("el-input"),y=u("el-form-item"),m=u("el-button"),R=u("el-form"),t=u("el-table-column"),n=u("BaseTableColumn"),c=u("el-table"),v=u("el-pagination"),i=u("el-card"),d=q("auth"),P=q("loading");return _(),h(i,null,{default:r(()=>[o(R,{inline:!0,model:a(l).queryForm,onKeyup:$(a(e),["enter"])},{default:r(()=>[o(y,null,{default:r(()=>[o(B,{modelValue:a(l).queryForm.username,"onUpdate:modelValue":p[0]||(p[0]=f=>a(l).queryForm.username=f),placeholder:"用户名",clearable:""},null,8,["modelValue"])]),_:1}),o(y,null,{default:r(()=>[o(m,{onClick:a(e)},{default:r(()=>[C("查询")]),_:1},8,["onClick"])]),_:1}),o(y,null,{default:r(()=>[S((_(),h(m,{type:"primary",onClick:p[1]||(p[1]=f=>L(null))},{default:r(()=>[C("新增")]),_:1})),[[d,"sys:user:save"]])]),_:1})]),_:1},8,["model","onKeyup"]),S((_(),h(c,{data:a(l).dataList,border:"",style:{width:"100%"},onSelectionChange:a(s)},{default:r(()=>[o(t,{type:"selection","header-align":"center",align:"center",width:"50"}),o(t,{prop:"username",label:"用户名","header-align":"center",align:"center"}),o(n,{prop:"gender",label:"性别","dict-type":"user_gender"}),o(t,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"150"},{default:r(f=>[S((_(),h(m,{type:"primary",link:"",onClick:O=>L(f.row.id)},{default:r(()=>[C("修改 ")]),_:2},1032,["onClick"])),[[d,"sys:user:update"]]),S((_(),h(m,{type:"danger",link:"",onClick:O=>a(z)(f.row.id)},{default:r(()=>[C("删除 ")]),_:2},1032,["onClick"])),[[d,"sys:user:delete"]])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[P,a(l).dataListLoading]]),o(v,{"current-page":a(l).page,"page-sizes":a(l).pageSizes,"page-size":a(l).limit,total:a(l).total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a(D),onCurrentChange:a(x)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"]),o(I,{ref_key:"saveRef",ref:U,"base-url":a(l).baseUrl,onRefresh:a(e)},null,8,["base-url","onRefresh"])]),_:1})}}});export{G as default};
