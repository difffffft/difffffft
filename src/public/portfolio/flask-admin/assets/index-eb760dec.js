import{F as K,G as O,u as M,f as N,h as R,r,H as w,o as m,A as p,n as a,b as t,k as e,q as G,l as i,w as _,I,t as z,J,K as P,s as T,E as h}from"./index-bf47055b.js";const Q=y=>K.post("/sys/attachment",y),W=T({name:"SysAttachment"}),Y=Object.assign(W,{setup(y){const{state:l,getDataList:f,selectionChangeHandle:S,sizeChangeHandle:k,currentChangeHandle:F,deleteBatchHandle:C,downloadHandle:A}=O({baseUrl:"/sys/attachment",queryForm:{name:"",platform:""}}),U=M(),V=N({Authorization:U.token}),b=R({name:"",platform:"",size:"",url:""}),q=(u,o)=>{if(u.code!==0)return h.error("上传失败："+u.msg),!1;Object.assign(b,u.data),Q(b).then(()=>{h.success({message:"上传成功",duration:500,onClose:()=>{f()}})})},L=u=>u.size/1024/1024/1024/1024>1?(h.error("文件大小不能超过100M"),!1):!0;return(u,o)=>{const v=r("el-input"),d=r("el-form-item"),c=r("el-button"),x=r("el-upload"),H=r("el-form"),s=r("el-table-column"),B=r("el-table"),D=r("el-pagination"),$=r("el-card"),g=w("auth"),E=w("loading");return m(),p($,null,{default:a(()=>[t(H,{inline:!0,model:e(l).queryForm,onKeyup:o[4]||(o[4]=G(n=>e(f)(),["enter"]))},{default:a(()=>[t(d,null,{default:a(()=>[t(v,{modelValue:e(l).queryForm.name,"onUpdate:modelValue":o[0]||(o[0]=n=>e(l).queryForm.name=n),placeholder:"附件名称"},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(v,{modelValue:e(l).queryForm.platform,"onUpdate:modelValue":o[1]||(o[1]=n=>e(l).queryForm.platform=n),placeholder:"存储平台"},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(c,{onClick:o[2]||(o[2]=n=>e(f)())},{default:a(()=>[i("查询")]),_:1})]),_:1}),_((m(),p(d,null,{default:a(()=>[t(x,{action:e(I),headers:V.value,"before-upload":L,"on-success":q,"show-file-list":!1},{default:a(()=>[t(c,{type:"primary"},{default:a(()=>[i("上传")]),_:1})]),_:1},8,["action","headers"])]),_:1})),[[g,"sys:attachment:save"]]),t(d,null,{default:a(()=>[_((m(),p(c,{type:"danger",onClick:o[3]||(o[3]=n=>e(C)())},{default:a(()=>[i("删除")]),_:1})),[[g,"sys:attachment:delete"]])]),_:1})]),_:1},8,["model"]),_((m(),p(B,{data:e(l).dataList,border:"",style:{width:"100%"},onSelectionChange:e(S)},{default:a(()=>[t(s,{type:"selection","header-align":"center",align:"center",width:"50"}),t(s,{prop:"name",label:"附件名称","show-overflow-tooltip":"","header-align":"center",align:"center"}),t(s,{label:"附件地址","show-overflow-tooltip":"","header-align":"center",align:"center"},{default:a(n=>[i(z(e(J)+n.row.url),1)]),_:1}),t(s,{prop:"size",label:"附件大小","header-align":"center",align:"center"},{default:a(n=>[i(z(e(P)(n.row.size)),1)]),_:1}),t(s,{prop:"platform",label:"存储平台","header-align":"center",align:"center"}),t(s,{prop:"create_time",label:"创建时间","header-align":"center",align:"center"}),t(s,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"150"},{default:a(n=>[t(c,{type:"primary",link:"",onClick:j=>e(A)(n.row.url,n.row.name)},{default:a(()=>[i("下载")]),_:2},1032,["onClick"]),_((m(),p(c,{type:"primary",link:"",onClick:j=>e(C)(n.row.id)},{default:a(()=>[i(" 删除 ")]),_:2},1032,["onClick"])),[[g,"sys:attachment:delete"]])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[E,e(l).dataListLoading]]),t(D,{"current-page":e(l).page,"page-sizes":e(l).pageSizes,"page-size":e(l).limit,total:e(l).total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e(k),onCurrentChange:e(F)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])]),_:1})}}});export{Y as default};
